<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=msapplication-TileImage content="/ms-icon-144x144.png"><meta name=msapplication-TileColor content="#1793d0"><meta name=theme-color content="#1793d0"><title>SecurityValley CTF 2022~2023 | Ma1icious' Blog</title><meta property="og:title" content="SecurityValley CTF 2022~2023 - Ma1icious' Blog"><meta property="og:type" content="article"><meta property="article:published_time" content="2023-05-20T13:54:49+08:00"><meta property="article:modified_time" content="2023-05-20T13:54:49+08:00"><meta name=keywords content="HTML,hugo,CSS"><meta name=description content="SecurityValley CTF 2022~2023"><meta name=author content><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=96x96 href=/favicon-96x96.png><link rel=icon type=image/png sizes=192x192 href=/android-icon-192x192.png><link rel=apple-touch-icon sizes=57x57 href=/apple-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=/apple-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=/apple-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=/apple-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=/apple-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=/apple-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=/apple-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=/apple-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-icon-180x180.png><link rel=stylesheet type=text/css href=/css/hulga.min.css><link rel=stylesheet type=text/css href=/css/hulga-dark.min.css media="(prefers-color-scheme: dark)"><link rel=manifest href=/manifest.json></head><body><div id=main><section class="hero is-primary shadow-hero"><div class=hero-head><nav class="navbar is-primary"><div class=container><div class=navbar-brand><a class=navbar-item href=/>Ma1icious' Blog</a>
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div class=navbar-menu id=navMenu><div class=navbar-end><a class=navbar-item href=/ title=index>Home</a>
<a class=navbar-item href=/archives/ title=archives>Archives</a>
<a class=navbar-item href=/tags/ title=tags>Tags</a>
<a class=navbar-item href=/categories/ title=categories>Categories</a></div></div></div></nav></div><div class=hero-body><header class="container has-text-centered"><h1 class="title post-title">SecurityValley CTF 2022~2023</h1><h2 class=subtitle><time class=post-meta>2023/05/20</time> ãƒ»
<span class="post-tag post-meta"><a href=/categories/ctf>CTF</a></span>
<span class="post-tag post-meta"><a href=/categories/writeup>writeup</a></span></h2><div class="tagbox post-meta"><span class=post-tag><a href=/tags/ctf>#CTF</a></span>
<span class=post-tag><a href=/tags/writeup>#writeup</a></span></div></header></div></section><section class=section><div class=container><div class=columns><div class="column is-1 is-hidden-mobile"></div><div class="column is-8"><article class=content id=post-content><p>This is a writeup for SecurityValley CTF 2022~2023.</p><p>CTF Time URL: <a href=https://ctftime.org/event/1799>SecurityValley - always on CTF</a></p><p>Official URL: <a href=https://ctf.securityvalley.org/>SecurityValley</a></p><h2 id=coding>Coding</h2><h3 id=easy-authentication>Easy authentication</h3><p>First we get the source code from <a href=https://github.com/SecurityValley/PublicCTFChallenges/blob/master/coding/easy_authentication>github</a>.</p><p>In function <code>validate</code>, we can see that the password is <code>[106,117,115,116,95,119,97,114,109,105,110,103,95,117,112]</code>.</p><p>Convert the password to ASCII by using python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>password</span> <span class=o>=</span> <span class=p>[</span><span class=mi>106</span><span class=p>,</span><span class=mi>117</span><span class=p>,</span><span class=mi>115</span><span class=p>,</span><span class=mi>116</span><span class=p>,</span><span class=mi>95</span><span class=p>,</span><span class=mi>119</span><span class=p>,</span><span class=mi>97</span><span class=p>,</span><span class=mi>114</span><span class=p>,</span><span class=mi>109</span><span class=p>,</span><span class=mi>105</span><span class=p>,</span><span class=mi>110</span><span class=p>,</span><span class=mi>103</span><span class=p>,</span><span class=mi>95</span><span class=p>,</span><span class=mi>117</span><span class=p>,</span><span class=mi>112</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>password</span><span class=p>]))</span>
</span></span></code></pre></div><p>After running the code, we get the password <code>just_warming_up</code>.</p><p>Then we can get the flag by using the command in function <code>banner</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Ma1icious@host ~ % curl -X POST http://ctf.securityvalley.org:7777/api/v1/validate -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;pass&#34;: &#34;just_warming_up&#34;}&#39;</span>
</span></span></code></pre></div><h3 id=good-authentication>Good authentication</h3><p>First we get the source code from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/coding/good_authentication>github</a>.</p><p>In function <code>validate</code>, the password is divided into three sections, each of which is 4 bytes. Then, according to the different blocks, the ASCII values of the characters in the block are XOR with 7, 11, and 9 respectively and converted to a string.</p><p>In the end, the three strings are concatenated and compared with <code>sontTbxTjffe</code>.</p><p>We can use python to get the password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>entered</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>password</span> <span class=o>=</span> <span class=s1>&#39;sontTbxTjffe&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>blocks</span> <span class=o>=</span> <span class=p>[</span><span class=n>password</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>password</span><span class=p>),</span> <span class=mi>4</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>blocks</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>[</span><span class=n>index</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>index</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>entered</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=o>^</span> <span class=mi>7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>index</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>entered</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=o>^</span> <span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>entered</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>char</span><span class=p>)</span> <span class=o>^</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>entered</span><span class=p>)</span>
</span></span></code></pre></div><p>After running the code, we get the password <code>this_is_cool</code>.</p><p>Then we can get the flag by using the command in function <code>banner</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Ma1icious@host ~ % curl -X POST http://ctf.securityvalley.org:7777/api/v1/validate -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;pass&#34;: &#34;this_is_cool&#34;}&#39;</span>
</span></span></code></pre></div><h3 id=hash-auth>Hash auth</h3><p>First we get the source code from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/coding/hash_auth>github</a>.</p><p>In the function <code>validate_password</code>, what we enter is encrypted by SHA256 algorithm. The result of the encryption will be compared with the value of <code>f51f333ed26c41bedd99e1e483c0a15d2caeed7dc5a9ae02159f196799a74893</code>.</p><p>We can see the prompt in this function: <code>be creative. it has something to do with SecurityValley ;-)</code>.</p><p>In CTF, people may use the number <code>1</code> in place of the letter <code>i</code> or <code>l</code>, and other numbers in place of similar letters.</p><p>So we can get a password dictionary like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>SecurityValley
</span></span><span class=line><span class=cl>Secur1tyValley
</span></span><span class=line><span class=cl>SecurityVa1ley
</span></span><span class=line><span class=cl>SecurityVal1ey
</span></span><span class=line><span class=cl>Secur1tyVa1ley
</span></span><span class=line><span class=cl>Secur1tyVal1ey
</span></span><span class=line><span class=cl>SecurityVa11ey
</span></span><span class=line><span class=cl>...
</span></span></code></pre></div><p>Fortunately, after a few attempts, we got the correct password. The password is <code>Secur1tyValley</code>.</p><p>Then we can get the flag by using the command in function <code>banner</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Ma1icious@host ~ % curl -X POST http://ctf.securityvalley.org:7777/api/v1/validate -H <span class=s1>&#39;Content-Type: application/json&#39;</span> -d <span class=s1>&#39;{&#34;pass&#34;: &#34;Secur1tyValley&#34;}&#39;</span>
</span></span></code></pre></div><h3 id=weird-code>Weird code</h3><p>First we get the source code from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/coding/weird_code>github</a>.</p><p>This is a &ldquo;.pyc&rdquo; file, but some information is missing and cannot be restored directly. Therefore, we need to restore step by step according to the <a href=https://docs.python.org/3.8/library/dis.html>dis document</a>.</p><h4 id=function-1>Function 1</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl> 15           0 LOAD_GLOBAL              0 (print)
</span></span><span class=line><span class=cl>              2 LOAD_CONST               1 (&#39;loading application&#39;)
</span></span><span class=line><span class=cl>              4 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>              6 POP_TOP
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 17           8 LOAD_GLOBAL              1 (magic)
</span></span><span class=line><span class=cl>             10 LOAD_CONST               2 (&#39;8934&#39;)
</span></span><span class=line><span class=cl>             12 LOAD_GLOBAL              2 (get_flag)
</span></span><span class=line><span class=cl>             14 CALL_FUNCTION            0
</span></span><span class=line><span class=cl>             16 CALL_FUNCTION            2
</span></span><span class=line><span class=cl>             18 STORE_FAST               0 (d)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 19          20 LOAD_GLOBAL              0 (print)
</span></span><span class=line><span class=cl>             22 LOAD_FAST                0 (d)
</span></span><span class=line><span class=cl>             24 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             26 POP_TOP
</span></span><span class=line><span class=cl>             28 LOAD_CONST               0 (None)
</span></span><span class=line><span class=cl>             30 RETURN_VALUE
</span></span></code></pre></div><p>At first, this function will print <code>loading application</code> and then call function <code>magic</code> with parameters <code>8934</code> and return value of the <code>get_flag</code> function. The result of the function <code>magic</code> will be assigned to variable <code>d</code>. Finally, the value of variable <code>d</code> will be printed.</p><p>So we can revert function 1 to the following source code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>function1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;loading application&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>magic</span><span class=p>(</span><span class=mi>8934</span><span class=p>,</span> <span class=n>get_flag</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span></code></pre></div><h4 id=function-2>Function 2</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>4           0 LOAD_CONST               1 (&#39;k\\PbYUHDAM[[VJlVAMVk[VWQE&#39;)
</span></span><span class=line><span class=cl>            2 RETURN_VALUE
</span></span></code></pre></div><p>This function just return a string <code>k\PbYUHDAM[[VJlVAMVk[VWQE</code>.</p><p>We can revert function 2 to the following source code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>function2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;k</span><span class=se>\\</span><span class=s1>PbYUHDAM[[VJlVAMVk[VWQE&#39;</span>
</span></span></code></pre></div><h4 id=function-3>Function 3</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>  7           0 LOAD_CONST               1 (b&#39;&#39;)
</span></span><span class=line><span class=cl>              2 STORE_FAST               2 (out)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  9           4 LOAD_GLOBAL              0 (range)
</span></span><span class=line><span class=cl>              6 LOAD_GLOBAL              1 (len)
</span></span><span class=line><span class=cl>              8 LOAD_FAST                1 (f)
</span></span><span class=line><span class=cl>             10 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             12 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             14 GET_ITER
</span></span><span class=line><span class=cl>        &gt;&gt;   16 FOR_ITER                46 (to 64)
</span></span><span class=line><span class=cl>             18 STORE_FAST               3 (i)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 10          20 LOAD_FAST                2 (out)
</span></span><span class=line><span class=cl>             22 LOAD_GLOBAL              2 (bytes)
</span></span><span class=line><span class=cl>             24 LOAD_GLOBAL              3 (ord)
</span></span><span class=line><span class=cl>             26 LOAD_FAST                1 (f)
</span></span><span class=line><span class=cl>             28 LOAD_FAST                3 (i)
</span></span><span class=line><span class=cl>             30 BINARY_SUBSCR
</span></span><span class=line><span class=cl>             32 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             34 LOAD_GLOBAL              3 (ord)
</span></span><span class=line><span class=cl>             36 LOAD_FAST                0 (k)
</span></span><span class=line><span class=cl>             38 LOAD_FAST                3 (i)
</span></span><span class=line><span class=cl>             40 LOAD_GLOBAL              1 (len)
</span></span><span class=line><span class=cl>             42 LOAD_FAST                0 (k)
</span></span><span class=line><span class=cl>             44 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             46 BINARY_MODULO
</span></span><span class=line><span class=cl>             48 BINARY_SUBSCR
</span></span><span class=line><span class=cl>             50 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             52 BINARY_XOR
</span></span><span class=line><span class=cl>             54 BUILD_LIST               1
</span></span><span class=line><span class=cl>             56 CALL_FUNCTION            1
</span></span><span class=line><span class=cl>             58 INPLACE_ADD
</span></span><span class=line><span class=cl>             60 STORE_FAST               2 (out)
</span></span><span class=line><span class=cl>             62 JUMP_ABSOLUTE           16
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> 12     &gt;&gt;   64 LOAD_FAST                2 (out)
</span></span><span class=line><span class=cl>             66 RETURN_VALUE
</span></span></code></pre></div><p>This function is complex and requires piecewise restoration. Here are the steps to restore:</p><ol><li><code>0</code> ~ <code>2</code> -> <code>out = b''</code></li><li><code>4</code> ~ <code>14</code> -> <code>for i in range(len(f)):</code></li><li><code>26</code> ~ <code>30</code> -> <code>f[i]</code></li><li><code>24</code> ~ <code>32</code> -> <code>ord(f[i])</code></li><li><code>40</code> ~ <code>44</code> -> <code>len(k)</code></li><li><code>38</code> ~ <code>46</code> -> <code>i % len(k)</code></li><li><code>36</code> ~ <code>48</code> -> <code>k[i % len(k)]</code></li><li><code>34</code> ~ <code>50</code> -> <code>ord(k[i % len(k)])</code></li><li><code>24</code> ~ <code>52</code> -> <code>ord(f[i]) ^ ord(k[i % len(k)])</code></li><li><code>24</code> ~ <code>54</code> -> <code>[ord(f[i]) ^ ord(k[i % len(k)])]</code></li><li><code>22</code> ~ <code>56</code> -> <code>bytes([ord(f[i]) ^ ord(k[i % len(k)])])</code></li><li><code>20</code> ~ <code>58</code> -> <code>out += bytes([ord(f[i]) ^ ord(k[i % len(k)])])</code></li><li><code>64</code> ~ <code>66</code> -> <code>return out</code></li></ol><p>So we can revert function 3 to the following source code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>function3</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>f</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=nb>ord</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>k</span><span class=p>)])])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span></code></pre></div><h4 id=combine-them>Combine them!</h4><p>Now we can combine the three functions together:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>function1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;loading application&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>magic</span><span class=p>(</span><span class=mi>8934</span><span class=p>,</span> <span class=n>get_flag</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>function2</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;k</span><span class=se>\\</span><span class=s1>PbYUHDAM[[VJlVAMVk[VWQE&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>function3</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>f</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=nb>ord</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>k</span><span class=p>)])])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span></code></pre></div><p>In function1 there are two functions &ldquo;magic&rdquo; and &ldquo;get_flag&rdquo;. From the overall code, you can see that function2 is &ldquo;get_flag&rdquo; and function3 is &ldquo;magic&rdquo;.</p><p>So the final source code looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>hello</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;loading application&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>magic</span><span class=p>(</span><span class=mi>8934</span><span class=p>,</span> <span class=n>get_flag</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_flag</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s1>&#39;k</span><span class=se>\\</span><span class=s1>PbYUHDAM[[VJlVAMVk[VWQE&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>magic</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>f</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span> <span class=o>+=</span> <span class=nb>bytes</span><span class=p>([</span><span class=nb>ord</span><span class=p>(</span><span class=n>f</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>k</span><span class=p>[</span><span class=n>i</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>k</span><span class=p>)])])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hello</span><span class=p>()</span>
</span></span></code></pre></div><p>After running the code, we get the flag.</p><h3 id=what-the-hell>What the HELL</h3><p>Look at the URL, go to a page with only one input box, and get the <code>hell.js</code> file from the source code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>changeHandler</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>window</span><span class=p>.</span><span class=nx>hell_key</span> <span class=o>=</span> <span class=nx>e</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>cmd</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;a&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;696564797e2a6f662a372a6e65697f676f647e246d6f7e4f666f676f647e4873436e22286c666b6d27657f7e282331006f66246364646f785e6f727e2a372a6b31&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;7d63646e657d246c666b6d2a372a284770653b465e5f3c44633a704560537e4460653b465e4f3c44633a7247606538465e4f724560697e475e4b3c44633a704560697e475e5f3c44593a3f4560537e47706539465e4f3b45605f7e454e6538465e5f3c44633a7247606538465e4f734560537e475e5f3c44593a734560537e445e6539465e5b3c44733a72445e653b465e533c44633a3b4560697e475e5b3c44633a724560437e475e473c447d373728&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;2a2a2a2a2a2a2a2a666f7e2a686665682a372a646f7d2a4866656822516b7e656822284673326d6e52446650494862684d6e7c43493a6d434d44626863483f68395f6d69675c38505240705059487a6e4e32415338337f69395b6d53594b33434943255a703263496772666e49487c6e525b6d5a594b63436d7a6768394365684d5c3a434d616d5a594b7d4573487a434e7d6d53593f79505d3f646e4d6d3d434d61784173616d6f7d656d43494b6d684d5c3a4342586668524b6d5a594862466744655352404e683858665b525b656b59616d40634b7d6f4f504d49634b6d4349487950525b6d68494b334342586668524b6d40634b7d6f4e484d49634b6d4349487950525b6d6b494b334349623a505d3b7d434e3e21434e5b7a4349536d4742624d5860794149634b6d4349487a50634b65414d61784759616d5a5e3a6d53593f79505d3f646e4d6d7a4342794143494b6d43494b6d4349487c6e525b6d41703a6d68494b78436065634173486549634b6d43494833434d5c7969385f6d6f7d656d43494b6d43494b6d434d333b6e494b785a5948794349796345634378434d6d7843633a6349634b6d4349483349643a4128235726717e737a6f30282a6b7a7a6663696b7e636564257e6f727e287723002a2a2a2a002a2a2a2a2a2a2a2a696564797e2a6f666f676f647e2a372a6e65697f676f647e2469786f6b7e6f4f666f676f647e22286b282331002a2a2a2a2a2a2a2a6f666f676f647e24796f7e4b7e7e7863687f7e6f222862786f6c28262a7d63646e657d245f58462469786f6b7e6f4568606f697e5f58462268666568232331002a2a2a2a2a2a2a2a6f666f676f647e24796f7e4b7e7e7863687f7e6f22286e657d6466656b6e28262a28676f79796b6d6f556c78656755626f6666247e727e282331002a2a2a2a2a2a2a2a6f666f676f647e24797e73666f246e63797a666b732a372a286465646f2831002a2a2a2a2a2a2a2a6e65697f676f647e2468656e73246b7a7a6f646e496263666e226f666f676f647e2331002a2a2a2a2a2a2a2a6f666f676f647e246966636961222331002a2a2a2a2a2a2a2a6e65697f676f647e2468656e7324786f67657c6f496263666e226f666f676f647e2331&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>l_cmd</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>preloader</span><span class=p>()</span> <span class=p>{</span>    
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>a</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>a</span> <span class=o>&lt;</span> <span class=nx>cmd</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>a</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=kd>let</span> <span class=nx>t</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>cmd</span><span class=p>[</span><span class=nx>a</span><span class=p>][</span><span class=mi>1</span><span class=p>].</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span> <span class=o>+=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>t</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nb>String</span><span class=p>.</span><span class=nx>fromCharCode</span><span class=p>(</span><span class=nb>parseInt</span><span class=p>(</span><span class=nx>cmd</span><span class=p>[</span><span class=nx>a</span><span class=p>][</span><span class=mi>1</span><span class=p>].</span><span class=nx>substr</span><span class=p>(</span><span class=nx>i</span><span class=p>,</span> <span class=mi>2</span><span class=p>),</span> <span class=mi>16</span><span class=p>)</span> <span class=o>^</span> <span class=mh>0xA</span><span class=p>));</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nx>l_cmd</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=k>new</span> <span class=nb>Function</span><span class=p>(</span><span class=nx>cmd</span><span class=p>[</span><span class=nx>a</span><span class=p>][</span><span class=mi>0</span><span class=p>],</span><span class=nx>t</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>preloader</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>l_cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=s2>&#34;closed...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>l_cmd</span><span class=p>[</span><span class=mi>1</span><span class=p>]()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>setInterval</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>hell_key</span> <span class=o>==</span> <span class=s2>&#34;666&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>l_cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=s2>&#34;MESSAGE FROM HELL!&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>window</span><span class=p>.</span><span class=nx>hell_key</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>l_cmd</span><span class=p>[</span><span class=mi>2</span><span class=p>]()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>l_cmd</span><span class=p>[</span><span class=mi>0</span><span class=p>](</span><span class=s2>&#34;still closed...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;DOMContentLoaded&#34;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>input</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;hell-key&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>input</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;input&#39;</span><span class=p>,</span> <span class=nx>changeHandler</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>main</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>From the code, we can see that the input box is used to enter the key. When the key is <code>666</code>, the function <code>l_cmd[2]()</code> will be executed.</p><p>We input <code>666</code> into the input box and press Enter, then we get a file named <code>message_from_hell.txt</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// used algo -  can you reverse it?
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>a</span> <span class=o>=</span> <span class=s2>&#34;???&#34;</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>out</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>for</span><span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>temp</span> <span class=o>=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>charCodeAt</span><span class=p>(</span><span class=nx>i</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>temp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>l</span> <span class=o>=</span> <span class=nx>temp</span> <span class=o>&amp;</span> <span class=mh>0x0F</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>h</span> <span class=o>=</span> <span class=p>(</span><span class=nx>temp</span> <span class=o>&gt;&gt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFF</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=nx>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=nx>a</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>out</span> <span class=o>+=</span> <span class=nx>l</span> <span class=o>+</span><span class=s2>&#34;:&#34;</span><span class=o>+</span> <span class=nx>h</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>out</span> <span class=o>+=</span> <span class=nx>l</span> <span class=o>+</span><span class=s2>&#34;:&#34;</span><span class=o>+</span> <span class=nx>h</span><span class=o>+</span><span class=s2>&#34;-&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this js script, string <code>a</code> is processed to become the <code>out</code> string. Execute the contents of this script in the console and get the result <code>15:3-15:3-15:3</code>.</p><p>Perusing the file <code>hell.js</code>, the second cmd item is unknown to us.</p><p>Convert the second item in cmd using Python, and the result is:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>window.flag = &#34;Mzo1LTU6Ni0zOjYtNjo1LTE6Ni0xMjo2LTExOjctMTA6Ni0zOjctMTU6NS05OjYtMzo3LTE1OjUtODo2LTU6Ni0xMjo2LTEyOjYtMTU6NS0yOjYtNTo3LTQ6Ny0xNTo1LTY6Ni01OjctMTQ6Ni0xOjItMTM6Nw==&#34;
</span></span></code></pre></div><p>Decode the flag using b64decode in python to get result <code>3:5-5:6-3:6-6:5-1:6-12:6-11:7-10:6-3:7-15:5-9:6-3:7-15:5-8:6-5:6-12:6-12:6-15:5-2:6-5:7-4:7-15:5-6:6-5:7-14:6-1:2-13:7</code>.</p><p>Now that we know the value of <code>out</code> in <code>message_from_hell.txt</code>, we need to deduce the value of <code>a</code> in reverse.</p><p>From the source code can be obtained by <code>l</code> and <code>h</code> to obtain the <code>temp</code> value method: <code>temp = (h &lt;&lt; 4) | l</code>.</p><p>So we can write a script that restores <code>out</code> to <code>a</code>, as shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>out</span> <span class=o>=</span> <span class=s2>&#34;3:5-5:6-3:6-6:5-1:6-12:6-11:7-10:6-3:7-15:5-9:6-3:7-15:5-8:6-5:6-12:6-12:6-15:5-2:6-5:7-4:7-15:5-6:6-5:7-14:6-1:2-13:7&#34;</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>out</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;-&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>l</span><span class=p>,</span> <span class=n>h</span> <span class=o>=</span> <span class=n>i</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>((</span><span class=nb>int</span><span class=p>(</span><span class=n>h</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>)</span> <span class=o>|</span> <span class=nb>int</span><span class=p>(</span><span class=n>l</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=reversing>Reversing</h2><h3 id=simple-elf>Simple ELF</h3><p>First we download elf file from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/reversing/the_elf>github</a>.</p><p>Then we use Ghidra to decompile this elf file.</p><p>We can see the source code below in the <code>main</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>undefined8</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Sometimes, there is something inside me. Can you get it?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printFlag</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Proceed to the source code for the <code>printFlag</code> function, as shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>printFlag</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%c </span><span class=se>\n</span><span class=s>Whoops, that was weird?? </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=mh>0x53</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This function just print a character <code>S</code> and a string <code>Whoops, that was weird??</code>.</p><p>Looking around, we can find the following in assembly code:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>                     **************************************************************
                     *                          FUNCTION                          *
                     **************************************************************
                     undefined printFlag()
     undefined         AL:1           &lt;RETURN&gt;
     undefined8        Stack[-0x10]:8 local_10                                XREF[2]:     0010117c(W), 
                                                                                           00101180(R)  
                     printFlag                                       XREF[4]:     Entry Point(*), main:001011bf(c), 
                                                                                  001020b0, 00102150(*)  
00101169 f3 0f 1e fa     ENDBR64
0010116d 55              PUSH       RBP
0010116e 48 89 e5        MOV        RBP,RSP
00101171 48 83 ec 10     SUB        RSP,0x10
00101175 48 8d 05        LEA        RAX,[s_SecVal{cr4ck1n9_15_E45y}_00102008]        = &#34;SecVal{cr4ck1n9_15_E45y}&#34;
         8c 0e 00 00
0010117c 48 89 45 f8     MOV        qword ptr [RBP + local_10],RAX=&gt;s_SecVal{cr4ck   = &#34;SecVal{cr4ck1n9_15_E45y}&#34;
00101180 48 8b 45 f8     MOV        RAX,qword ptr [RBP + local_10]
00101184 0f b6 00        MOVZX      EAX=&gt;s_SecVal{cr4ck1n9_15_E45y}_00102008,byte    = &#34;SecVal{cr4ck1n9_15_E45y}&#34;
00101187 0f be c0        MOVSX      EAX,AL
0010118a 89 c6           MOV        ESI,EAX
0010118c 48 8d 05        LEA        RAX,[s_%c_Whoops,_that_was_weird??_00102028]     = &#34;%c \nWhoops, that was weird??
         95 0e 00 00
00101193 48 89 c7        MOV        RDI=&gt;s_%c_Whoops,_that_was_weird??_00102028,RAX  = &#34;%c \nWhoops, that was weird??
00101196 b8 00 00        MOV        EAX,0x0
         00 00
0010119b e8 d0 fe        CALL       &lt;EXTERNAL&gt;::printf                               int printf(char * __format, ...)
         ff ff
001011a0 90              NOP
001011a1 c9              LEAVE
001011a2 c3              RET
</code></pre><h3 id=no-statics>No statics</h3><p>First we download elf file from <a href=https://github.com/SecurityValley/PublicCTFChallenges/blob/master/reversing/no_static/crackme-02>github</a>.</p><p>Then we use Ghidra to decompile this elf file.</p><p>The source code for the <code>main</code> function is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>undefined8</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>in_FS_OFFSET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>local_3a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_32</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>local_31</span> <span class=p>[</span><span class=mi>9</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>local_28</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>local_20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>local_18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>local_10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>local_10</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Again, there is something inside me!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>local_28</span> <span class=o>=</span> <span class=mh>0x5d84756a5f6c6e5c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_20</span> <span class=o>=</span> <span class=mh>0x683e6a60683e3a71</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_18</span> <span class=o>=</span> <span class=mh>0x865b3c6d7b6a51</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_3a</span> <span class=o>=</span> <span class=mh>0x80717e6f715f8579</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_32</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;enter your passphrase, please!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>local_31</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;try:%s ........ </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>local_31</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>prepare</span><span class=p>(</span><span class=o>&amp;</span><span class=n>local_3a</span><span class=p>,</span><span class=mh>0xc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_3a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>iVar1</span> <span class=o>=</span> <span class=nf>strcmp</span><span class=p>(</span><span class=n>local_31</span><span class=p>,(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>local_3a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>iVar1</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>prepare</span><span class=p>(</span><span class=o>&amp;</span><span class=n>local_28</span><span class=p>,</span><span class=mi>9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;WRONG!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>local_10</span> <span class=o>!=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>    <span class=nf>__stack_chk_fail</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=wrong-practice>Wrong practice</h4><p>In <code>main</code> function, we can see that the <code>local_28</code>, <code>local_20</code>, <code>local_18</code>, <code>local_3a</code> variables are assigned values, and then the <code>prepare</code> function is called.</p><p>Our input is assigned to <code>local_31</code> by <code>fgets</code>, and then <code>local_31</code> is compared with <code>local_3a</code>.</p><p>If the comparison is successful, the <code>prepare</code> function is called again, and the result is printed.</p><p>Because the variable <code>local_3a</code> is going to be printed, we can execute the program once to get the value of <code>local_3a</code> and then use the value to get the flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Ma1icious@host ~ % ./crackme-02
</span></span><span class=line><span class=cl>Again, there is something inside me!
</span></span><span class=line><span class=cl>enter your passphrase, please!
</span></span><span class=line><span class=cl>aaaa
</span></span><span class=line><span class=cl>try:aaaa
</span></span><span class=line><span class=cl> ........ 
</span></span><span class=line><span class=cl>mySecret 
</span></span><span class=line><span class=cl>WRONG!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ma1icious@host ~ % ./crackme-02
</span></span><span class=line><span class=cl>Again, there is something inside me!
</span></span><span class=line><span class=cl>enter your passphrase, please!
</span></span><span class=line><span class=cl>mySecret
</span></span><span class=line><span class=cl>try:mySecret ........ 
</span></span><span class=line><span class=cl>mySecret 
</span></span><span class=line><span class=cl>SecVal<span class=o>{</span>**********<span class=o>}</span>
</span></span></code></pre></div><h4 id=correct-practice>Correct practice</h4><p>Here is the source code for the <code>prepare</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>prepare</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>param_1</span><span class=p>,</span><span class=kt>char</span> <span class=n>param_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>size_t</span> <span class=n>sVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>local_20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nf>strlen</span><span class=p>(</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>local_20</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span><span class=p>(</span> <span class=nb>true</span> <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>sVar1</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>sVar1</span> <span class=o>&lt;=</span> <span class=p>(</span><span class=n>ulong</span><span class=p>)(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_20</span><span class=p>)</span> <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>=</span> <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>-</span> <span class=n>param_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>local_20</span> <span class=o>=</span> <span class=n>local_20</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can do the same thing with Python:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span> <span class=n>param_2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>local_20</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>param_1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>local_20</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>])</span> <span class=o>-</span> <span class=n>param_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>local_20</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>param_1</span>
</span></span></code></pre></div><p>Try to get the processed value of local_3a to make sure our function is correct.</p><p>Since the elf program is <code>little-endian</code>, we need to flip the byte order:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span> <span class=n>param_2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>local_20</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>param_1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>local_20</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>=</span> <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>-</span> <span class=n>param_2</span>
</span></span><span class=line><span class=cl>        <span class=n>local_20</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>param_1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_3a</span> <span class=o>=</span> <span class=s1>&#39;80717e6f715f8579&#39;</span>
</span></span><span class=line><span class=cl><span class=n>local_3a</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>local_3a</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>local_3a</span><span class=p>),</span> <span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>local_3a</span><span class=o>.</span><span class=n>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prepare_result</span> <span class=o>=</span> <span class=n>prepare</span><span class=p>(</span><span class=n>local_3a</span><span class=p>,</span> <span class=mh>0xc</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>out_string</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>prepare_result</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>out_string</span><span class=p>)</span>
</span></span></code></pre></div><p>After running the code, we get the result <code>mySecret</code>.</p><p>We can get the flag using the following code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span> <span class=n>param_2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>local_20</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>param_1</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=n>local_20</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>=</span> <span class=n>param_1</span><span class=p>[</span><span class=n>local_20</span><span class=p>]</span> <span class=o>-</span> <span class=n>param_2</span>
</span></span><span class=line><span class=cl>        <span class=n>local_20</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>param_1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_28</span> <span class=o>=</span> <span class=s1>&#39;5d84756a5f6c6e5c&#39;</span>
</span></span><span class=line><span class=cl><span class=n>local_28</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>local_28</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>local_28</span><span class=p>),</span> <span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>local_28</span><span class=o>.</span><span class=n>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_20</span> <span class=o>=</span> <span class=s1>&#39;683e6a60683e3a71&#39;</span>
</span></span><span class=line><span class=cl><span class=n>local_20</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>local_20</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>local_20</span><span class=p>),</span> <span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>local_20</span><span class=o>.</span><span class=n>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_18</span> <span class=o>=</span> <span class=s1>&#39;865b3c6d7b6a51&#39;</span>
</span></span><span class=line><span class=cl><span class=n>local_18</span> <span class=o>=</span> <span class=p>[</span><span class=nb>int</span><span class=p>(</span><span class=n>local_18</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>2</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>local_18</span><span class=p>),</span> <span class=mi>2</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>local_18</span><span class=o>.</span><span class=n>reverse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag_code</span> <span class=o>=</span> <span class=n>local_28</span> <span class=o>+</span> <span class=n>local_20</span> <span class=o>+</span> <span class=n>local_18</span>
</span></span><span class=line><span class=cl><span class=n>prepare_result</span> <span class=o>=</span> <span class=n>prepare</span><span class=p>(</span><span class=n>flag_code</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>)</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>prepare_result</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=the-loader>The loader</h3><p>First we download elf file from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/reversing/the_loader>github</a>.</p><p>Then we use Ghidra to decompile this elf file.</p><p><code>main</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>uVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>in_FS_OFFSET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>local_1c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=o>*</span><span class=n>local_18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>local_10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>local_10</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_FS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>local_18</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_00102018</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_1c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>adjustCounter</span><span class=p>(</span><span class=o>&amp;</span><span class=n>local_1c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>uVar1</span> <span class=o>=</span> <span class=nf>getHop</span><span class=p>(</span><span class=n>local_1c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d.%s </span><span class=se>\n\n</span><span class=s>Wouldn</span><span class=se>\&#39;</span><span class=s>t it be cool to be able to look into the memory?</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>,(</span><span class=n>ulong</span><span class=p>)</span><span class=n>local_1c</span><span class=p>,</span>
</span></span><span class=line><span class=cl>           <span class=n>uVar1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>huuu</span><span class=p>(</span><span class=n>local_18</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>local_1c</span> <span class=o>=</span> <span class=n>local_1c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>while</span><span class=p>(</span> <span class=nb>true</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>adjustCounter</code> function and <code>getHop</code> function are just change the value of <code>local_1c</code> and return a string.</p><p>The most critical is the <code>huuu</code> function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>huuu</span><span class=p>(</span><span class=n>undefined8</span> <span class=n>param_1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>uVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>uVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>uVar1</span> <span class=o>=</span> <span class=nf>load_s_mem</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span><span class=mh>0xfe</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar2</span> <span class=o>=</span> <span class=nf>get_str_size</span><span class=p>(</span><span class=n>uVar1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>unload_mem</span><span class=p>(</span><span class=n>uVar1</span><span class=p>,</span><span class=n>uVar2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In this function, the <code>load_s_mem</code> function is called to load the memory and do some processing, and then the <code>unload_mem</code> function is called to unload the memory.</p><p>The <code>load_s_mem</code> function is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=o>*</span> <span class=nf>load_s_mem</span><span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=n>param_1</span><span class=p>,</span><span class=n>byte</span> <span class=n>param_2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>size_t</span> <span class=n>__size</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>__dest</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>local_1c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>__size</span> <span class=o>=</span> <span class=nf>get_str_size</span><span class=p>(</span><span class=n>param_1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>__dest</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>__size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memcpy</span><span class=p>(</span><span class=n>__dest</span><span class=p>,</span><span class=n>param_1</span><span class=p>,</span><span class=n>__size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=n>local_1c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=p>(</span><span class=n>ulong</span><span class=p>)(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_1c</span> <span class=o>&lt;</span> <span class=n>__size</span><span class=p>;</span> <span class=n>local_1c</span> <span class=o>=</span> <span class=n>local_1c</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=p>(</span><span class=n>byte</span> <span class=o>*</span><span class=p>)((</span><span class=kt>long</span><span class=p>)</span><span class=n>__dest</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_1c</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>byte</span> <span class=o>*</span><span class=p>)((</span><span class=kt>long</span><span class=p>)</span><span class=n>__dest</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>local_1c</span><span class=p>)</span> <span class=o>^</span> <span class=n>param_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=p>(</span><span class=n>undefined</span> <span class=o>*</span><span class=p>)(</span><span class=n>__size</span> <span class=o>+</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>__dest</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>__dest</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Maybe this function will calculate the flag, but we don&rsquo;t know the value of <code>param_1</code> and <code>param_2</code>.</p><p>Combining <code>main</code> and <code>huuu</code>, we know that <code>param_1</code> is the value of <code>local_18</code> in <code>main</code> (that is <code>&amp;DAT_00102018</code>) and <code>param_2</code> is <code>0xfe</code>.</p><p>The data in DAT_00102018 is:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>  DAT_00102018                                    XREF[3]:     main:001013b3(*), 
                                                               main:001013ba(*), 
                                                               main:001013fb(*)  
00102018 ad              ??         ADh
00102019 9b              ??         9Bh
0010201a 9d              ??         9Dh
0010201b a8              ??         A8h
0010201c 9f              ??         9Fh
0010201d 92              ??         92h
0010201e 85              ??         85h
0010201f 89              ??         89h
00102020 ca              ??         CAh
00102021 a7              ??         A7h
00102022 a1              ??         A1h
00102023 c9              ??         C9h
00102024 ce              ??         CEh
00102025 a1              ??         A1h
00102026 96              ??         96h
00102027 ca              ??         CAh
00102028 8c              ??         8Ch
00102029 ba              ??         BAh
0010202a a1              ??         A1h
0010202b b8              ??         B8h
0010202c ce              ??         CEh
0010202d ac              ??         ACh
0010202e a1              ??         A1h
0010202f a7              ??         A7h
00102030 ce              ??         CEh
00102031 ab              ??         ABh
00102032 83              ??         83h
00102033 00              ??         00h
00102034 00              ??         00h
00102035 00              ??         00h
00102036 00              ??         00h
00102037 00              ??         00h
</code></pre><p>So we can calculate the value of <code>uVar1</code> in the <code>huuu</code> function using the following Python code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=s2>&#34;ADh,9Bh,9Dh,A8h,9Fh,92h,85h,89h,CAh,A7h,A1h,C9h,CEh,A1h,96h,CAh,8Ch,BAh,A1h,B8h,CEh,ACh,A1h,A7h,CEh,ABh,83h&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>DAT</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>item</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>DAT</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>item</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;h&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>),</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mh>0xfe</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>DAT</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>DAT</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=n>offset</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=damn-windows>damn windows</h3><p>First download the file from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/reversing/damn_windows>github</a>.</p><p>This file is an pe file, so we should test this file on windows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\U</span>sers<span class=se>\m</span>a1icious<span class=se>\D</span>esktop&gt; .<span class=se>\0</span>1.exe
</span></span><span class=line><span class=cl>can you deal with a more complex language <span class=k>then</span> C?
</span></span><span class=line><span class=cl>please enter the password
</span></span><span class=line><span class=cl>ma1icious
</span></span><span class=line><span class=cl>2023/05/20 16:46:06 wrong password kid
</span></span></code></pre></div><p>We use Ghidra to decompile this pe file. Search the hexadecimal of the string <code>wrong</code> and find the following code:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>  DAT_004b26d7                                    XREF[2]:     main.(*PasswordService).Validate
                                                               main.(*PasswordService).Validate
004b26d7 77              ??         77h    w
004b26d8 72              ??         72h    r
004b26d9 6f              ??         6Fh    o
004b26da 6e              ??         6Eh    n
004b26db 67              ??         67h    g
004b26dc 20              ??         20h     
004b26dd 70              ??         70h    p
004b26de 61              ??         61h    a
004b26df 73              ??         73h    s
004b26e0 73              ??         73h    s
004b26e1 77              ??         77h    w
004b26e2 6f              ??         6Fh    o
004b26e3 72              ??         72h    r
004b26e4 64              ??         64h    d
004b26e5 20              ??         20h     
004b26e6 6b              ??         6Bh    k
004b26e7 69              ??         69h    i
004b26e8 64              ??         64h    d
</code></pre><p>Jump to the function that references the string.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>undefined</span>  <span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=n>main</span><span class=p>.(</span><span class=o>*</span><span class=n>PasswordService</span><span class=p>).</span><span class=nf>Validate</span><span class=p>(</span><span class=n>undefined8</span> <span class=n>param_1</span><span class=p>,</span><span class=n>undefined8</span> <span class=n>param_2</span><span class=p>,</span><span class=kt>int</span> <span class=n>param_3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>cVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=o>*</span><span class=n>puVar3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar4</span> <span class=p>[</span><span class=mi>32</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar5</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>param_11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_48</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_38</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_28</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_18</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>param_11</span> <span class=o>=</span> <span class=n>param_2</span><span class=p>,</span> <span class=n>local_18</span> <span class=o>+</span> <span class=mi>8</span> <span class=o>&lt;=</span> <span class=n>CURRENT_G</span><span class=p>.</span><span class=n>stackguard0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=p>.</span><span class=nf>morestack_noctxt</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>param_2</span> <span class=o>=</span> <span class=n>param_11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>local_48</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_48</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_004b00a8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_38</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_38</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_004afb6e</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_28</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=mh>0xc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_28</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_004b1275</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_18</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_18</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_004afb6f</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>auVar5</span> <span class=o>=</span> <span class=n>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=n>local_48</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>auVar5</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>==</span> <span class=n>param_3</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>cVar1</span> <span class=o>=</span> <span class=n>runtime</span><span class=p>.</span><span class=nf>memequal</span><span class=p>(</span><span class=n>param_2</span><span class=p>,</span><span class=n>auVar5</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>),</span> <span class=n>cVar1</span> <span class=o>!=</span> <span class=sc>&#39;\0&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>iVar2</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>iVar2</span> <span class=o>=</span> <span class=n>runtime</span><span class=p>.</span><span class=nf>cmpstring</span><span class=p>(</span><span class=n>param_2</span><span class=p>,</span><span class=n>param_3</span><span class=p>,</span><span class=n>auVar5</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>,</span><span class=n>auVar5</span><span class=p>.</span><span class=n>_8_8_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>iVar2</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>iVar2</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>iVar2</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>iVar2</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar3</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>(</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar3</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>puVar3</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_004b26d7</span><span class=p>;</span>    <span class=c1>// wrong password kid
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>auVar4</span><span class=p>.</span><span class=n>_0_16_</span> <span class=o>=</span> <span class=nf>ZEXT816</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar4</span><span class=p>.</span><span class=n>_16_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>go</span><span class=p>.</span><span class=n>itab</span><span class=p>.</span><span class=o>*</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString</span><span class=p>,</span><span class=n>error</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar4</span><span class=p>.</span><span class=n>_24_8_</span> <span class=o>=</span> <span class=n>puVar3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>ZEXT1632</span><span class=p>(</span><span class=nf>CONCAT88</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=o>&amp;</span><span class=n>DAT_004b04ef</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>By analyzing the function, we can know that the function concatenates four strings, then compares the concatenated string length with <code>param_3</code>, and compares the content of the string with <code>param_2</code>.</p><p>Let&rsquo;s take a wild guess that <code>param_3</code> is the length of our input string and <code>param_2</code> is the content of our input string.</p><p>So we can get the string (<code>local_48</code> + <code>local_38</code> + <code>local28</code> + <code>local_18</code>) from the assembly code for comparison.</p><p>Fortunately, the string after this combination is Flag.</p><h3 id=forgotten-license-key>Forgotten license key</h3><p>First download the file from <a href=https://github.com/SecurityValley/PublicCTFChallenges/tree/master/reversing/forgotten_license_key>github</a>.</p><p>This file is an pe file, so we should test this file on windows.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\U</span>sers<span class=se>\m</span>a1icious<span class=se>\D</span>esktop&gt; .<span class=se>\l</span>icense.exe --key<span class=o>=</span><span class=m>123456</span>
</span></span><span class=line><span class=cl>wrong length
</span></span></code></pre></div><p>We use Ghidra to decompile this pe file. Search the hexadecimal of the string <code>wrong</code> and find the following code:</p><pre tabindex=0><code class=language-assembly data-lang=assembly>  DAT_005a84d6                                    XREF[1]:     005e5d18(*)  
005a84d6 77              ??         77h    w
005a84d7 72              ??         72h    r
005a84d8 6f              ??         6Fh    o
005a84d9 6e              ??         6Eh    n
005a84da 67              ??         67h    g
005a84db 20              ??         20h     
005a84dc 6c              ??         6Ch    l
005a84dd 65              ??         65h    e
005a84de 6e              ??         6Eh    n
005a84df 67              ??         67h    g
005a84e0 74              ??         74h    t
005a84e1 68              ??         68h    h
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>main</span><span class=p>.</span><span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>_Argc</span><span class=p>,</span><span class=kt>char</span> <span class=o>**</span><span class=n>_Argv</span><span class=p>,</span><span class=kt>char</span> <span class=o>**</span><span class=n>_Env</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>undefined</span> <span class=p>(</span><span class=o>*</span><span class=n>key</span><span class=p>)</span> <span class=p>[</span><span class=mi>32</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>byte</span> <span class=o>*</span><span class=n>extraout_RAX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_CL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_CL_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_CL_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_CL_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>size_t</span> <span class=n>extraout_RBX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_SIL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_SIL_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_SIL_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_SIL_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_SIL_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_DIL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_DIL_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_DIL_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_DIL_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_DIL_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_04</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B_05</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_04</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B_05</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_04</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B_05</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_02</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_03</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_04</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B_05</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar1</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar2</span> <span class=p>[</span><span class=mi>24</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffff90</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffff98</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffffa0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffffa8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffffb0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_38</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_28</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>local_18</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>auVar1</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>_Argv</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=n>_Argc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_38</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined</span>  <span class=p>[</span><span class=mi>16</span><span class=p>])</span><span class=mh>0x0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>stack0x00000000</span> <span class=o>&lt;=</span> <span class=n>CURRENT_G</span><span class=p>.</span><span class=n>stackguard0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar1</span> <span class=o>=</span> <span class=n>runtime</span><span class=p>.</span><span class=nf>morestack_noctxt</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>gopkg</span><span class=p>.</span><span class=n>in</span><span class=o>/</span><span class=n>alecthomas</span><span class=o>/</span><span class=n>kingpin</span><span class=o>%</span><span class=mi>2</span><span class=n>ev2</span><span class=p>.</span><span class=nf>Parse</span><span class=p>(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>,</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_8_8_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>key</span> <span class=o>=</span> <span class=o>*</span><span class=n>DAT_006f0e30</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>DAT_006f0e30</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=p>(</span><span class=nf>undefined</span> <span class=p>(</span><span class=o>*</span><span class=p>)</span> <span class=p>[</span><span class=mi>32</span><span class=p>])</span><span class=mh>0x9</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar1</span> <span class=o>=</span> <span class=n>main</span><span class=p>.</span><span class=nf>validateLicenseFormat</span>
</span></span><span class=line><span class=cl>                       <span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>key</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=n>extraout_CL</span><span class=p>,</span><span class=n>extraout_DIL</span><span class=p>,</span><span class=n>extraout_SIL</span><span class=p>,</span><span class=n>extraout_R8B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>extraout_R9B</span><span class=p>,</span><span class=n>extraout_R10B</span><span class=p>,</span><span class=n>extraout_R11B</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffff98</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>auVar1</span> <span class=o>=</span> <span class=p>(</span><span class=o>**</span><span class=p>(</span><span class=n>code</span> <span class=o>**</span><span class=p>)(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>+</span> <span class=mh>0x18</span><span class=p>))(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_8_8_</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>local_28</span> <span class=o>=</span> <span class=n>local_38</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>local_28</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>           <span class=n>runtime</span><span class=p>.</span><span class=nf>convTstring</span><span class=p>(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>,</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_8_8_</span><span class=p>,</span><span class=n>extraout_CL_01</span><span class=p>,</span><span class=n>extraout_DIL_01</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>extraout_SIL_01</span><span class=p>,</span><span class=n>extraout_R8B_01</span><span class=p>,</span><span class=n>extraout_R9B_01</span><span class=p>,</span><span class=n>extraout_R10B_01</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>extraout_R11B_01</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff98</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>local_28</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>string___runtime</span><span class=p>.</span><span class=n>_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>auVar2</span> <span class=o>=</span> <span class=n>fmt</span><span class=p>.</span><span class=nf>Fprintln</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>io</span><span class=p>.</span><span class=n>Writer___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>,</span><span class=n>DAT_006f0e78</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=p>(</span><span class=n>runtime</span><span class=p>.</span><span class=n>structtype</span> <span class=o>**</span><span class=p>)</span><span class=n>local_28</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>extraout_R8B_02</span><span class=p>,</span><span class=n>extraout_R9B_02</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>extraout_R10B_02</span><span class=p>,</span><span class=n>extraout_R11B_02</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>in_stack_ffffffffffffff98</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffa0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>in_stack_ffffffffffffffa8</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffb0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>auVar2</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>.</span><span class=nf>loadStaticLicense</span>
</span></span><span class=line><span class=cl>              <span class=p>(</span><span class=n>key</span><span class=p>,</span><span class=mi>9</span><span class=p>,</span><span class=n>extraout_CL_00</span><span class=p>,</span><span class=n>extraout_DIL_00</span><span class=p>,</span><span class=n>extraout_SIL_00</span><span class=p>,</span><span class=n>extraout_R8B_00</span><span class=p>,</span><span class=n>extraout_R9B_00</span><span class=p>,</span>
</span></span><span class=line><span class=cl>               <span class=n>extraout_R10B_00</span><span class=p>,</span><span class=n>extraout_R11B_00</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff98</span>
</span></span><span class=line><span class=cl>              <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar1</span> <span class=o>=</span> <span class=n>runtime</span><span class=p>.</span><span class=nf>slicebytetostring</span>
</span></span><span class=line><span class=cl>                       <span class=p>((</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=mh>0x0</span><span class=p>,</span><span class=n>extraout_RAX</span><span class=p>,</span><span class=n>extraout_RBX</span><span class=p>,</span><span class=n>extraout_DIL_02</span><span class=p>,</span><span class=n>extraout_SIL_02</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>extraout_R8B_03</span><span class=p>,</span><span class=n>extraout_R9B_03</span><span class=p>,</span><span class=n>extraout_R10B_03</span><span class=p>,</span><span class=n>extraout_R11B_03</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff98</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffffa0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>local_38</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>         <span class=n>runtime</span><span class=p>.</span><span class=nf>convTstring</span><span class=p>(</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>,</span><span class=n>auVar1</span><span class=p>.</span><span class=n>_8_8_</span><span class=p>,</span><span class=n>extraout_CL_02</span><span class=p>,</span><span class=n>extraout_DIL_03</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>extraout_SIL_03</span><span class=p>,</span><span class=n>extraout_R8B_04</span><span class=p>,</span><span class=n>extraout_R9B_04</span><span class=p>,</span><span class=n>extraout_R10B_04</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                             <span class=n>extraout_R11B_04</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff98</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>local_38</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>string___runtime</span><span class=p>.</span><span class=n>_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar2</span> <span class=o>=</span> <span class=n>fmt</span><span class=p>.</span><span class=nf>Fprintln</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>io</span><span class=p>.</span><span class=n>Writer___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>,</span><span class=n>DAT_006f0e78</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=n>runtime</span><span class=p>.</span><span class=n>structtype</span> <span class=o>**</span><span class=p>)</span><span class=n>local_38</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>extraout_R8B_05</span><span class=p>,</span><span class=n>extraout_R9B_05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>extraout_R10B_05</span><span class=p>,</span><span class=n>extraout_R11B_05</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>in_stack_ffffffffffffff98</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffa0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                          <span class=n>in_stack_ffffffffffffffa8</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffb0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar2</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>local_18</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>PTR_DAT_005e5d18</span><span class=p>;</span>   <span class=c1>// wrong length
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>local_18</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>string___runtime</span><span class=p>.</span><span class=n>_type</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>auVar2</span> <span class=o>=</span> <span class=n>fmt</span><span class=p>.</span><span class=nf>Fprintln</span><span class=p>((</span><span class=kt>int</span><span class=p>)</span><span class=o>&amp;</span><span class=n>io</span><span class=p>.</span><span class=n>Writer___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>,</span><span class=n>DAT_006f0e78</span><span class=p>,(</span><span class=n>runtime</span><span class=p>.</span><span class=n>structtype</span> <span class=o>**</span><span class=p>)</span><span class=n>local_18</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>extraout_R8B</span><span class=p>,</span><span class=n>extraout_R9B</span><span class=p>,</span><span class=n>extraout_R10B</span><span class=p>,</span><span class=n>extraout_R11B</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffff90</span><span class=p>,</span><span class=n>in_stack_ffffffffffffff98</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffffa0</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffa8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>in_stack_ffffffffffffffb0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>auVar2</span><span class=p>.</span><span class=n>_0_8_</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We know from above that the correct length is <code>9</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\U</span>sers<span class=se>\m</span>a1icious<span class=se>\D</span>esktop&gt; .<span class=se>\l</span>icense.exe --key<span class=o>=</span><span class=m>123456789</span>
</span></span><span class=line><span class=cl>expect <span class=s2>&#34;-&#34;</span> at position <span class=m>4</span>
</span></span></code></pre></div><p>Repeat the above steps to jump to the following functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>undefined</span>  <span class=p>[</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>main</span><span class=p>.</span><span class=nf>validateLicenseFormat</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>param_1</span><span class=p>,</span><span class=n>uint</span> <span class=n>param_2</span><span class=p>,</span><span class=n>byte</span> <span class=n>param_3</span><span class=p>,</span><span class=n>byte</span> <span class=n>param_4</span><span class=p>,</span><span class=n>byte</span> <span class=n>param_5</span><span class=p>,</span><span class=n>undefined</span> <span class=n>param_6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>undefined</span> <span class=n>param_7</span><span class=p>,</span><span class=n>undefined</span> <span class=n>param_8</span><span class=p>,</span><span class=n>undefined</span> <span class=n>param_9</span><span class=p>,</span><span class=n>undefined8</span> <span class=n>param_10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=n>undefined8</span> <span class=n>param_11</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>byte</span> <span class=n>bVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=o>*</span><span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>uVar3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>sdword</span> <span class=n>sVar4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>uVar5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>extraout_RCX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>uVar6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>uVar7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>extraout_RSI</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>uVar8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>uVar9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uint</span> <span class=n>extraout_RDI</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R8B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R9B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R10B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>extraout_R11B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar10</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar11</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar12</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar13</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined</span> <span class=n>auVar14</span> <span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=n>in_stack_ffffffffffffffe8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>uVar9</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint</span><span class=p>)</span><span class=n>param_4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar7</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint</span><span class=p>)</span><span class=n>param_5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar5</span> <span class=o>=</span> <span class=p>(</span><span class=n>uint</span><span class=p>)</span><span class=n>param_3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=o>&amp;</span><span class=n>stack0x00000000</span> <span class=o>&lt;=</span> <span class=n>CURRENT_G</span><span class=p>.</span><span class=n>stackguard0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=p>.</span><span class=nf>morestack_noctxt</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>uVar5</span> <span class=o>=</span> <span class=n>extraout_RCX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>uVar7</span> <span class=o>=</span> <span class=n>extraout_RSI</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>uVar9</span> <span class=o>=</span> <span class=n>extraout_RDI</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>param_6</span> <span class=o>=</span> <span class=n>extraout_R8B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>param_7</span> <span class=o>=</span> <span class=n>extraout_R9B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>param_8</span> <span class=o>=</span> <span class=n>extraout_R10B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>param_9</span> <span class=o>=</span> <span class=n>extraout_R11B</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=p>.</span><span class=nf>panicIndex</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=n>param_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar6</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined</span><span class=p>)</span><span class=n>param_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar3</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined</span><span class=p>)</span><span class=n>uVar5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>uVar8</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined</span><span class=p>)</span><span class=n>uVar9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;-&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>((</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>,</span><span class=n>uVar6</span><span class=p>,</span><span class=n>uVar3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>uVar8</span><span class=p>,(</span><span class=kt>char</span><span class=p>)</span><span class=n>uVar7</span><span class=p>,</span><span class=n>param_6</span><span class=p>,</span><span class=n>param_7</span><span class=p>,</span><span class=n>param_8</span><span class=p>,</span><span class=n>param_9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>in_stack_ffffffffffffffe8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>puVar2</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_005ac18a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar14</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar14</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>error___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar14</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=n>param_1</span> <span class=o>!=</span> <span class=sc>&#39;7&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>((</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>,</span><span class=n>uVar6</span><span class=p>,</span><span class=n>uVar3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>uVar8</span><span class=p>,(</span><span class=kt>char</span><span class=p>)</span><span class=n>uVar7</span><span class=p>,</span><span class=n>param_6</span><span class=p>,</span><span class=n>param_7</span><span class=p>,</span><span class=n>param_8</span><span class=p>,</span><span class=n>param_9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>in_stack_ffffffffffffffe8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>puVar2</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_005ac1a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar13</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar13</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>error___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar13</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=p>.</span><span class=nf>panicIndex</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=n>param_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>param_1</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span> <span class=o>!=</span> <span class=sc>&#39;D&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>((</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>,</span><span class=n>uVar6</span><span class=p>,</span><span class=n>uVar3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>uVar8</span><span class=p>,</span><span class=n>param_1</span><span class=p>[</span><span class=mi>6</span><span class=p>],</span><span class=n>param_6</span><span class=p>,</span><span class=n>param_7</span><span class=p>,</span><span class=n>param_8</span><span class=p>,</span><span class=n>param_9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>in_stack_ffffffffffffffe8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>puVar2</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_005ac1ba</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar12</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar12</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>error___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=n>bVar1</span> <span class=o>=</span> <span class=n>param_1</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>dword</span><span class=p>)((</span><span class=n>byte</span><span class=p>)</span><span class=n>param_1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x37</span> <span class=o>+</span> <span class=p>(</span><span class=n>dword</span><span class=p>)(</span><span class=n>byte</span><span class=p>)</span><span class=n>param_1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>dword</span><span class=p>)</span><span class=n>bVar1</span><span class=p>)</span> <span class=o>!=</span> <span class=mh>0x102</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>((</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>,</span><span class=n>uVar6</span><span class=p>,</span><span class=n>uVar3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                               <span class=n>bVar1</span><span class=p>,</span><span class=mh>0x44</span><span class=p>,</span><span class=n>param_6</span><span class=p>,</span><span class=n>param_7</span><span class=p>,</span><span class=n>param_8</span><span class=p>,</span><span class=n>param_9</span><span class=p>,</span><span class=n>in_stack_ffffffffffffffe8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>puVar2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x2b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>puVar2</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_005b14fc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar11</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>auVar11</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>error___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>auVar11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=mi>7</span> <span class=o>&lt;</span> <span class=n>param_2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>param_2</span> <span class=o>&lt;</span> <span class=mi>9</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>      <span class=n>runtime</span><span class=p>.</span><span class=nf>panicIndex</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=n>param_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>sVar4</span> <span class=o>=</span> <span class=p>(</span><span class=n>dword</span><span class=p>)(</span><span class=n>byte</span><span class=p>)</span><span class=n>param_1</span><span class=p>[</span><span class=mi>8</span><span class=p>]</span> <span class=o>+</span> <span class=p>(</span><span class=n>byte</span><span class=p>)</span><span class=n>param_1</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>+</span> <span class=mh>0x44</span> <span class=o>+</span> <span class=p>(</span><span class=n>dword</span><span class=p>)(</span><span class=n>byte</span><span class=p>)</span><span class=n>param_1</span><span class=p>[</span><span class=mi>7</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>sVar4</span> <span class=o>!=</span> <span class=mh>0x11a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>puVar2</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>               <span class=n>runtime</span><span class=p>.</span><span class=nf>newobject</span><span class=p>((</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>errors</span><span class=p>.</span><span class=n>errorString___runtime</span><span class=p>.</span><span class=n>structtype</span><span class=p>,</span><span class=n>uVar6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                 <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>sVar4</span><span class=p>,</span><span class=n>bVar1</span><span class=p>,</span><span class=n>param_1</span><span class=p>[</span><span class=mi>7</span><span class=p>],</span><span class=n>param_6</span><span class=p>,</span><span class=n>param_7</span><span class=p>,</span><span class=n>param_8</span><span class=p>,</span><span class=n>param_9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                 <span class=n>in_stack_ffffffffffffffe8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>puVar2</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mh>0x2c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=o>*</span><span class=n>puVar2</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>DAT_005b195c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>auVar10</span><span class=p>.</span><span class=n>_8_8_</span> <span class=o>=</span> <span class=n>puVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=n>auVar10</span><span class=p>.</span><span class=n>_0_8_</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>error___runtime</span><span class=p>.</span><span class=n>itab</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>auVar10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>ZEXT816</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Subroutine does not return */</span>
</span></span><span class=line><span class=cl>  <span class=n>runtime</span><span class=p>.</span><span class=nf>panicIndex</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=n>param_2</span><span class=p>,</span><span class=n>param_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Based on the above code, the following conclusions can be drawn:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># ord(license[1]) + ord(license[2]) + ord(license[3]) + 0x37 = 0x102</span>
</span></span><span class=line><span class=cl><span class=c1># ord(license[5]) + ord(license[7]) + ord(license[8]) + 0x44 = 0x11a</span>
</span></span><span class=line><span class=cl><span class=n>license</span> <span class=o>=</span> <span class=s1>&#39;7***-*D**&#39;</span>
</span></span></code></pre></div><p>Enter any license that complies with the rules to obtain the output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PS C:<span class=se>\U</span>sers<span class=se>\m</span>a1icious<span class=se>\D</span>esktop&gt; .<span class=se>\l</span>icense.exe --key<span class=o>=</span>7CEC-GDGH
</span></span><span class=line><span class=cl>SG#aL<span class=o>{</span>_PAkZ_I!_
</span></span></code></pre></div><p>In function <code>main.loadStaticLicense</code>, we can learn how to calculate result by license. The code implemented in python is as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>secret</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>secret_length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>license</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=c1># input</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=c1># output</span>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=n>secret_length</span> <span class=o>&lt;=</span> <span class=n>index</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>break</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>char_index</span> <span class=o>=</span> <span class=n>index</span> <span class=o>%</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl>  <span class=n>result</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>secret</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>license</span><span class=p>[</span><span class=n>char_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>  <span class=n>index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span></code></pre></div><p>Get the secret value with the following python code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>secret</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;SG#aL{_PAkZ_I!_&#39;</span>
</span></span><span class=line><span class=cl><span class=n>license</span> <span class=o>=</span> <span class=s1>&#39;7CEC-GDGH&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>secret_length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>secret_length</span> <span class=o>&lt;=</span> <span class=n>index</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>char_index</span> <span class=o>=</span> <span class=n>index</span> <span class=o>%</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl>    <span class=n>secret</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=n>index</span><span class=p>])</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>license</span><span class=p>[</span><span class=n>char_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>secret</span><span class=p>)</span>
</span></span></code></pre></div><p>Since we know that the format of flag is <code>SecVal{}</code>, we can end up with a partially determined license: <code>7a46-gD</code>.</p><p>Since the rule <code>ord(license[5]) + ord(license[7]) + ord(license[8]) + 0x44 = 0x11a</code>, we can determine that <code>ord(license[7]) + ord(license[8]) = 111</code>.</p><p>Use the following Python script to brute-force the Flag value (because the missing part&rsquo;s matching rule is [0-9a-zA-Z], the brute-force can be narrowed down) :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>license</span> <span class=o>=</span> <span class=s2>&#34;7a46-gD&#34;</span>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>secret_length</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=n>secret</span> <span class=o>=</span> <span class=p>[</span><span class=mi>100</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>87</span><span class=p>,</span> <span class=mi>96</span><span class=p>,</span> <span class=mi>76</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>63</span><span class=p>,</span> <span class=mi>81</span><span class=p>,</span> <span class=mi>86</span><span class=p>,</span> <span class=mi>104</span><span class=p>,</span> <span class=mi>19</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>85</span><span class=p>,</span> <span class=mi>70</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>27</span><span class=p>,</span> <span class=mi>91</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>28</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>eight</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;6&#39;</span><span class=p>),</span> <span class=nb>ord</span><span class=p>(</span><span class=s1>&#39;9&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>nine</span> <span class=o>=</span> <span class=mi>111</span> <span class=o>-</span> <span class=n>eight</span>
</span></span><span class=line><span class=cl>    <span class=n>license_final</span> <span class=o>=</span> <span class=n>license</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>eight</span><span class=p>)</span> <span class=o>+</span> <span class=nb>chr</span><span class=p>(</span><span class=n>nine</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>secret_length</span> <span class=o>&lt;=</span> <span class=n>index</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>char_index</span> <span class=o>=</span> <span class=n>index</span> <span class=o>%</span> <span class=mi>9</span>
</span></span><span class=line><span class=cl>        <span class=n>out</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=n>secret</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>^</span> <span class=nb>ord</span><span class=p>(</span><span class=n>license_final</span><span class=p>[</span><span class=n>char_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>index</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>out</span><span class=p>)</span>
</span></span></code></pre></div></article></div><div class="column is-hidden-mobile"><div class=sidebar id=toc><div class="post post-toc" id=post-toc></div></div></div></div></div></div></section></div><footer class=footer><div class="content has-text-centered"><p>Powered by <a href=https://gohugo.io>Hugo</a>. Theme <a href=https://www.github.com/wlh320/hugo-theme-hulga>Hulga</a></p><p>Copyright Â© 2020 wlh. All rights reserved.</p></div></footer><script src=https://Ma1icious.github.io/js/pwa.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js></script><script>addBackToTop({diameter:42,backgroundColor:"#1793d0",innerHTML:'<svg viewBox="0 0 24 24"><path d="M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"/></svg>',textColor:"#fff"})</script>
<script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".navbar-burger"),0);e.length>0&&e.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.target,n=document.getElementById(t);e.classList.toggle("is-active"),n.classList.toggle("is-active")})})})</script><link id=hlcss rel=stylesheet type=text/css><script>function addCss(e){var t=document.getElementById("hlcss");t.href=e}var darkcss="https://Ma1icious.github.io/css/monokai.css",lightcss="https://Ma1icious.github.io/css/monokailight.css";window.matchMedia("(prefers-color-scheme)").media==="not all"?addCss(lightcss):addCss(window.matchMedia("(prefers-color-scheme: dark)").matches?darkcss:lightcss),window.matchMedia("(prefers-color-scheme: dark)").addListener(e=>e.matches&&addCss(darkcss)),window.matchMedia("(prefers-color-scheme: light)").addListener(e=>e.matches&&addCss(lightcss))</script><script src=https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js></script><script>anchors.options={placement:"left",icon:"#"},anchors.add(".content h1, .content h2, .content h3")</script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity="sha256-tn6hZ2YGDv0w1/DaFL4MiUoXuAVclrtFZs13ch3TB9M=" crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity="sha256-1qhJwAgsSPVSSjlQVTewHS49eaoAbOz651dveUANVBI=" crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity="sha256-oEuQVLwO5Ii6subChtLbrY5gx7NDRU+UJJ9jvvau+FI=" crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})})</script>
<link rel=stylesheet type=text/css href=https://Ma1icious.github.io/css/toc.min.css><script src=https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js></script>
<script>tocbot.init({tocSelector:".post-toc",contentSelector:"#post-content",headingSelector:"h1, h2, h3",collapseDepth:0,scrollSmooth:!0,positionFixedSelector:".post-toc",fixedSidebarOffset:273})</script></body></html>